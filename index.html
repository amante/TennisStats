<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tennis Win Probabilities — v1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Calculadora de probabilidades de ganar un partido de tenis entre dos jugadores usando tipo de cancha, resultados previos, head‑to‑head y estadísticas." />
  <style>
    /* Suaves micro-interacciones */
    .card { transition: box-shadow .2s ease, transform .2s ease; }
    .card:hover { box-shadow: 0 10px 24px rgba(0,0,0,.08); transform: translateY(-1px); }
    .mono { font-feature-settings: "ss01" on, "ss02" on; }
    .number-input::-webkit-outer-spin-button, .number-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .number-input { -moz-appearance: textfield; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <header class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex items-center justify-between gap-4">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Tennis Match Win Probabilities</h1>
      <div class="text-sm text-slate-500">v1.0 • 2025‑10‑06</div>
    </div>
    <p class="mt-2 text-slate-600">Calcula la probabilidad de que <span class="font-semibold">Jugador A</span> gane a <span class="font-semibold">Jugador B</span> considerando <span class="italic">cancha</span>, <span class="italic">forma reciente</span>, <span class="italic">cara a cara</span> y <span class="italic">estadísticas de juego</span>. Ajusta los pesos del modelo según prefieras.</p>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pb-24">
    <!-- Configuración global -->
    <section class="card bg-white rounded-2xl shadow-sm p-5 md:p-6 mb-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">Superficie</label>
          <select id="surface" class="w-full rounded-xl border border-slate-200 p-2.5">
            <option value="hard">Hard</option>
            <option value="clay">Clay</option>
            <option value="grass">Grass</option>
            <option value="carpet">Carpet/Indoor</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Formato del partido</label>
          <select id="format" class="w-full rounded-xl border border-slate-200 p-2.5">
            <option value="bo3">Best of 3</option>
            <option value="bo5">Best of 5</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm font-medium mb-1">H2H: Gana A</label>
            <input id="h2hA" type="number" min="0" step="1" value="0" class="number-input w-full rounded-xl border border-slate-200 p-2.5"/>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">H2H: Gana B</label>
            <input id="h2hB" type="number" min="0" step="1" value="0" class="number-input w-full rounded-xl border border-slate-200 p-2.5"/>
          </div>
        </div>
      </div>
    </section>

    <!-- Jugadores -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
      <!-- Jugador A -->
      <div class="card bg-white rounded-2xl shadow-sm p-5 md:p-6">
        <h2 class="text-lg font-semibold mb-4">Jugador A</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nombre</label>
            <input id="nameA" type="text" placeholder="Jugador A" class="w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Ranking (ATP/WTA)</label>
            <input id="rankA" type="number" min="1" step="1" placeholder="opcional" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Elo (opcional)</label>
            <input id="eloA" type="number" min="500" max="3500" step="1" placeholder="opcional" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Forma (últ. 10): Victorias</label>
            <input id="formWinsA" type="number" min="0" max="10" step="1" value="5" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Superficie (últ. 10): Victorias</label>
            <input id="surfWinsA" type="number" min="0" max="10" step="1" value="5" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Juegos de saque ganados %</label>
            <input id="holdA" type="number" min="0" max="100" step="0.1" value="80" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Juegos de resto ganados %</label>
            <input id="breakA" type="number" min="0" max="100" step="0.1" value="25" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
        </div>
      </div>

      <!-- Jugador B -->
      <div class="card bg-white rounded-2xl shadow-sm p-5 md:p-6">
        <h2 class="text-lg font-semibold mb-4">Jugador B</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nombre</label>
            <input id="nameB" type="text" placeholder="Jugador B" class="w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Ranking (ATP/WTA)</label>
            <input id="rankB" type="number" min="1" step="1" placeholder="opcional" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Elo (opcional)</label>
            <input id="eloB" type="number" min="500" max="3500" step="1" placeholder="opcional" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Forma (últ. 10): Victorias</label>
            <input id="formWinsB" type="number" min="0" max="10" step="1" value="5" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Superficie (últ. 10): Victorias</label>
            <input id="surfWinsB" type="number" min="0" max="10" step="1" value="5" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Juegos de saque ganados %</label>
            <input id="holdB" type="number" min="0" max="100" step="0.1" value="80" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Juegos de resto ganados %</label>
            <input id="breakB" type="number" min="0" max="100" step="0.1" value="25" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
          </div>
        </div>
      </div>
    </section>

    <!-- Pesos del modelo -->
    <details class="card bg-white rounded-2xl shadow-sm p-5 md:p-6 mb-6 open:animate-[fadeIn_.2s_ease]">
      <summary class="cursor-pointer text-lg font-semibold mb-2">Ajustes del modelo (avanzado)</summary>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mt-3">
        <div>
          <label class="block text-sm font-medium mb-1">Peso Elo/Ranking</label>
          <input id="wElo" type="number" step="0.05" value="1.00" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Peso Superficie</label>
          <input id="wSurf" type="number" step="0.05" value="0.80" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Peso Forma</label>
          <input id="wForm" type="number" step="0.05" value="0.60" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Peso H2H</label>
          <input id="wH2H" type="number" step="0.05" value="0.40" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Peso Saque+Resto</label>
          <input id="wSR" type="number" step="0.05" value="0.80" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Escala logística (k)</label>
          <input id="kScale" type="number" step="0.05" value="1.00" class="number-input w-full rounded-xl border border-slate-200 p-2.5" />
        </div>
      </div>
      <p class="text-xs text-slate-500 mt-3">Consejo: 100 puntos Elo ≈ +1 en la métrica de diferencia. Diferencias de tasas (forma/superficie) usan proporciones (0–1). Para <span class="font-medium">Best of 5</span> se intensifica la ventaja del favorito elevando las cuotas a una potencia f≈1.35.</p>
    </details>

    <!-- Acciones -->
    <section class="flex flex-wrap items-center gap-3 mb-6">
      <button id="calcBtn" class="px-4 py-2.5 rounded-xl bg-indigo-600 text-white font-medium hover:bg-indigo-500 active:bg-indigo-700">Calcular probabilidad</button>
      <button id="resetBtn" class="px-4 py-2.5 rounded-xl bg-slate-200 text-slate-800 font-medium hover:bg-slate-300">Reset</button>
      <div class="ml-auto flex items-center gap-2">
        <button id="exportBtn" class="px-3 py-2 rounded-xl bg-emerald-600 text-white text-sm font-medium hover:bg-emerald-500">Exportar JSON</button>
        <label class="px-3 py-2 rounded-xl bg-slate-800 text-white text-sm font-medium cursor-pointer hover:bg-slate-700">
          Importar JSON
          <input id="importFile" type="file" accept="application/json" class="hidden" />
        </label>
      </div>
    </section>

    <!-- Resultados -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="card bg-white rounded-2xl shadow-sm p-5 md:p-6 lg:col-span-2">
        <h3 class="text-lg font-semibold mb-4">Resultado del partido</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 items-center">
          <div>
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-slate-600"><span id="labelA" class="font-medium">Jugador A</span> gana</div>
              <div class="text-sm font-semibold" id="pA">–</div>
            </div>
            <div class="w-full h-3 bg-slate-200 rounded-full overflow-hidden">
              <div id="barA" class="h-3 bg-indigo-600" style="width: 0%"></div>
            </div>
          </div>
          <div>
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm text-slate-600"><span id="labelB" class="font-medium">Jugador B</span> gana</div>
              <div class="text-sm font-semibold" id="pB">–</div>
            </div>
            <div class="w-full h-3 bg-slate-200 rounded-full overflow-hidden">
              <div id="barB" class="h-3 bg-slate-900" style="width: 0%"></div>
            </div>
          </div>
        </div>
        <div class="mt-4 text-sm text-slate-600">Confianza del modelo: <span id="confidence" class="font-medium">–</span></div>
      </div>

      <div class="card bg-white rounded-2xl shadow-sm p-5 md:p-6">
        <h3 class="text-lg font-semibold mb-4">Desglose de contribuciones</h3>
        <ul id="contrib" class="space-y-2 text-sm"></ul>
        <p class="mt-3 text-xs text-slate-500">Las contribuciones se muestran en unidades normalizadas antes de la logística. Positivo favorece a <span class="font-medium">Jugador A</span>, negativo a <span class="font-medium">Jugador B</span>.</p>
      </div>
    </section>

    <footer class="mt-10 text-center text-xs text-slate-500">Hecho con cariño deportivo • Ajusta, itera y valida con tus datos reales</footer>
  </main>

  <script type="module">
    const $ = (id) => document.getElementById(id);

    // Utilidades
    const clamp = (v, min, max) => Math.min(Math.max(v, min), max);
    const logistic = (x) => 1 / (1 + Math.exp(-x));

    function parseNum(el, fallback = null) {
      const v = parseFloat(el.value);
      return Number.isFinite(v) ? v : fallback;
    }

    function pseudoEloFromRank(rank) {
      if (!Number.isFinite(rank)) return null;
      // Mapeo muy simple: a peor ranking, menor pseudo-elo. Capas suaves.
      // rank=1 -> 2400, rank=100 -> 2000, rank=500 -> 1700, rank>1000 -> 1500 aprox
      const e = 2600 - 2.0 * Math.min(rank, 800); // lineal truncado
      return clamp(e, 1200, 2600);
    }

    function getPlayerInput(prefix) {
      return {
        name: $("name"+prefix).value.trim() || (prefix === 'A' ? 'Jugador A' : 'Jugador B'),
        rank: parseNum($("rank"+prefix)),
        elo: parseNum($("elo"+prefix)),
        formWins: clamp(parseNum($("formWins"+prefix), 5), 0, 10),
        surfWins: clamp(parseNum($("surfWins"+prefix), 5), 0, 10),
        hold: clamp(parseNum($("hold"+prefix), 80), 0, 100),
        brk: clamp(parseNum($("break"+prefix), 25), 0, 100),
      };
    }

    function computeWeights() {
      return {
        wElo: parseNum($("#wElo"), 1.0),
        wSurf: parseNum($("#wSurf"), 0.8),
        wForm: parseNum($("#wForm"), 0.6),
        wH2H: parseNum($("#wH2H"), 0.4),
        wSR: parseNum($("#wSR"), 0.8),
        k: parseNum($("#kScale"), 1.0),
      };
    }

    function computeFeatures(A, B, h2hA, h2hB) {
      // Elo o pseudo-Elo por ranking
      const eloA = Number.isFinite(A.elo) ? A.elo : pseudoEloFromRank(A.rank);
      const eloB = Number.isFinite(B.elo) ? B.elo : pseudoEloFromRank(B.rank);
      const eloDiff = (Number.isFinite(eloA) && Number.isFinite(eloB)) ? (eloA - eloB) : 0;
      const fElo = eloDiff / 100; // 100 Elo ≈ 1 unidad

      // Forma y superficie (proporciones 0–1)
      const fForm = (A.formWins - B.formWins) / 10; // diff de winrate en los últimos 10
      const fSurf = (A.surfWins - B.surfWins) / 10; // diff de winrate en la superficie

      // Head-to-Head (suavizado para evitar sobre-ajustar)
      const totalH2H = h2hA + h2hB;
      const frac = totalH2H > 0 ? (h2hA - h2hB) / (totalH2H + 1) : 0; // +1 shrinkage
      const fH2H = frac; // ya está en [-1,1] aprox

      // Saque + resto: índice relativo
      const srA = (A.hold + A.brk) - 100; // si = 0 -> promedio teórico
      const srB = (B.hold + B.brk) - 100;
      const fSR = (srA - srB) / 20; // escalar

      return { fElo, fSurf, fForm, fH2H, fSR, eloA, eloB };
    }

    function combineToProbability(features, weights, bo5 = false) {
      const { fElo, fSurf, fForm, fH2H, fSR } = features;
      const { wElo, wSurf, wForm, wH2H, wSR, k } = weights;
      const score = (wElo*fElo) + (wSurf*fSurf) + (wForm*fForm) + (wH2H*fH2H) + (wSR*fSR);
      let p = logistic(k * score);
      // Ajuste Best-of-5: potencia a las cuotas (odds) para intensificar favoritos
      if (bo5) {
        const f = 1.35; // potencia sugerida
        const odds = p / (1 - p);
        const adjOdds = Math.pow(odds, f);
        p = adjOdds / (1 + adjOdds);
      }
      return { pA: p, score };
    }

    function computeConfidence(A, B, features) {
      // Cuenta cuántas fuentes aportan información
      let parts = 0;
      if (Number.isFinite(A.elo) || Number.isFinite(A.rank)) parts++;
      if (Number.isFinite(B.elo) || Number.isFinite(B.rank)) parts++;
      if (A.formWins !== null && B.formWins !== null) parts++;
      if (A.surfWins !== null && B.surfWins !== null) parts++;
      if (A.hold !== null && A.brk !== null && B.hold !== null && B.brk !== null) parts++;
      // Normaliza a un 0–100, 5 bloques posibles
      const conf = clamp((parts / 5) * 100, 0, 100);
      // Si Elo derivado de ranking, penaliza un poco
      const eloDerivedPenalty = (!Number.isFinite(A.elo) || !Number.isFinite(B.elo)) ? 8 : 0;
      return clamp(Math.round(conf - eloDerivedPenalty), 0, 100);
    }

    function render(A, B, pA, score, features, weights) {
      $("#labelA").textContent = A.name || 'Jugador A';
      $("#labelB").textContent = B.name || 'Jugador B';
      const pAperc = Math.round(pA * 1000) / 10;
      const pBperc = Math.round((1 - pA) * 1000) / 10;
      $("#pA").textContent = pAperc + '%';
      $("#pB").textContent = pBperc + '%';
      $("#barA").style.width = pAperc + '%';
      $("#barB").style.width = pBperc + '%';

      // Contribuciones
      const list = $("#contrib");
      list.innerHTML = '';
      const items = [
        {label: 'Elo/Ranking', val: weights.wElo * features.fElo},
        {label: 'Superficie',  val: weights.wSurf * features.fSurf},
        {label: 'Forma',       val: weights.wForm * features.fForm},
        {label: 'Head‑to‑Head',val: weights.wH2H * features.fH2H},
        {label: 'Saque+Resto', val: weights.wSR * features.fSR},
      ];
      for (const it of items) {
        const sign = it.val >= 0 ? '+' : '−';
        const mag = Math.abs(it.val);
        const pct = clamp(Math.round((mag / 3) * 100), 0, 100); // barra visual aproximada
        const li = document.createElement('li');
        li.innerHTML = `
          <div class="flex items-center justify-between">
            <div>${it.label}</div>
            <div class="mono tabular-nums">${sign}${mag.toFixed(2)}</div>
          </div>
          <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden mt-1">
            <div class="h-2 ${it.val>=0 ? 'bg-indigo-600' : 'bg-slate-900'}" style="width:${pct}%"></div>
          </div>
        `;
        list.appendChild(li);
      }
    }

    function readAllInputs() {
      const A = getPlayerInput('A');
      const B = getPlayerInput('B');
      const h2hA = clamp(parseNum($("#h2hA"), 0), 0, 999);
      const h2hB = clamp(parseNum($("#h2hB"), 0), 0, 999);
      const weights = computeWeights();
      const format = $("#format").value;
      return { A, B, h2hA, h2hB, weights, format };
    }

    function validateInputs(A, B) {
      const errs = [];
      for (const [lbl, v] of [["A hold%", A.hold],["A break%", A.brk],["B hold%", B.hold],["B break%", B.brk]]) {
        if (!Number.isFinite(v) || v < 0 || v > 100) errs.push(`${lbl} debe estar en 0–100`);
      }
      for (const [lbl, v] of [["A forma", A.formWins],["B forma", B.formWins],["A superficie", A.surfWins],["B superficie", B.surfWins]]) {
        if (!Number.isFinite(v) || v < 0 || v > 10) errs.push(`${lbl} (victorias) debe estar en 0–10`);
      }
      return errs;
    }

    function exportJSON() {
      const state = {
        surface: $("#surface").value,
        format: $("#format").value,
        h2hA: parseNum($("#h2hA"), 0),
        h2hB: parseNum($("#h2hB"), 0),
        playerA: {
          name: $("#nameA").value,
          rank: parseNum($("#rankA")), elo: parseNum($("#eloA")),
          formWins: parseNum($("#formWinsA"), 5),
          surfWins: parseNum($("#surfWinsA"), 5),
          hold: parseNum($("#holdA"), 80), brk: parseNum($("#breakA"), 25)
        },
        playerB: {
          name: $("#nameB").value,
          rank: parseNum($("#rankB")), elo: parseNum($("#eloB")),
          formWins: parseNum($("#formWinsB"), 5),
          surfWins: parseNum($("#surfWinsB"), 5),
          hold: parseNum($("#holdB"), 80), brk: parseNum($("#breakB"), 25)
        },
        weights: computeWeights(),
        version: 'v1.0',
        savedAt: new Date().toISOString(),
      };
      const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `tennis_model_${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function importJSON(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if (data.surface) $("#surface").value = data.surface;
          if (data.format) $("#format").value = data.format;
          if (Number.isFinite(data.h2hA)) $("#h2hA").value = data.h2hA;
          if (Number.isFinite(data.h2hB)) $("#h2hB").value = data.h2hB;
          const A = data.playerA || {}; const B = data.playerB || {};
          $("#nameA").value = A.name || '';
          $("#rankA").value = Number.isFinite(A.rank) ? A.rank : '';
          $("#eloA").value = Number.isFinite(A.elo) ? A.elo : '';
          $("#formWinsA").value = Number.isFinite(A.formWins) ? A.formWins : 5;
          $("#surfWinsA").value = Number.isFinite(A.surfWins) ? A.surfWins : 5;
          $("#holdA").value = Number.isFinite(A.hold) ? A.hold : 80;
          $("#breakA").value = Number.isFinite(A.brk) ? A.brk : 25;
          $("#nameB").value = B.name || '';
          $("#rankB").value = Number.isFinite(B.rank) ? B.rank : '';
          $("#eloB").value = Number.isFinite(B.elo) ? B.elo : '';
          $("#formWinsB").value = Number.isFinite(B.formWins) ? B.formWins : 5;
          $("#surfWinsB").value = Number.isFinite(B.surfWins) ? B.surfWins : 5;
          $("#holdB").value = Number.isFinite(B.hold) ? B.hold : 80;
          $("#breakB").value = Number.isFinite(B.brk) ? B.brk : 25;
          const W = data.weights || {};
          if (Number.isFinite(W.wElo)) $("#wElo").value = W.wElo;
          if (Number.isFinite(W.wSurf)) $("#wSurf").value = W.wSurf;
          if (Number.isFinite(W.wForm)) $("#wForm").value = W.wForm;
          if (Number.isFinite(W.wH2H)) $("#wH2H").value = W.wH2H;
          if (Number.isFinite(W.wSR)) $("#wSR").value = W.wSR;
          if (Number.isFinite(W.k)) $("#kScale").value = W.k;
        } catch (err) {
          alert('Archivo JSON inválido');
        }
      };
      reader.readAsText(file);
    }

    function calculate() {
      const { A, B, h2hA, h2hB, weights, format } = readAllInputs();
      const errs = validateInputs(A, B);
      if (errs.length) { alert('Corrige los siguientes errores:\n\n' + errs.join('\n')); return; }
      const feats = computeFeatures(A, B, h2hA, h2hB);
      const { pA, score } = combineToProbability(feats, weights, format === 'bo5');
      const conf = computeConfidence(A, B, feats);
      render(A, B, pA, score, feats, weights);
      $("#confidence").textContent = conf + '%';
    }

    function resetAll() {
      document.querySelectorAll('input').forEach(inp => {
        if (inp.type === 'number') {
          inp.value = inp.id.includes('hold') ? 80 : inp.id.includes('break') ? 25 : inp.max === '10' ? 5 : '';
        } else if (inp.type === 'text') {
          inp.value = '';
        }
      });
      $("#h2hA").value = 0; $("#h2hB").value = 0;
      $("#surface").value = 'hard'; $("#format").value = 'bo3';
      $("#wElo").value = 1.00; $("#wSurf").value = 0.80; $("#wForm").value = 0.60; $("#wH2H").value = 0.40; $("#wSR").value = 0.80; $("#kScale").value = 1.00;
      $("#pA").textContent = '–'; $("#pB").textContent = '–';
      $("#barA").style.width = '0%'; $("#barB").style.width = '0%';
      $("#contrib").innerHTML = '';
      $("#confidence").textContent = '–';
    }

    // Eventos
    $("#calcBtn").addEventListener('click', calculate);
    $("#resetBtn").addEventListener('click', resetAll);
    $("#exportBtn").addEventListener('click', exportJSON);
    $("#importFile").addEventListener('change', (e) => {
      if (e.target.files && e.target.files[0]) importJSON(e.target.files[0]);
    });

    // Atajos
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'enter') { calculate(); }
    });

    // Primer render con valores por defecto
    calculate();
  </script>
</body>
</html>
